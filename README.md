# CIS Hardening RHEL with OpenSCAP

This project demonstrates how to harden RHEL 9 to CIS Level 1 and 2 compliance using OpenSCAP and the SCAP Security Guide (SSG). It covers scanning, generating compliance reports, and applying automated remediation scripts. The repository includes sample commands, remediation workflows, and guidance for verifying compliance after hardening.

Key highlights:

- Install and configure oscap and scap-security-guide

- Run CIS Level 1 and 2 Server compliance scans

- Generate HTML compliance reports for auditing

- Create and apply Ansible/Bash remediation scripts

- Re-scan system to validate compliance

This project is intended as a reference for consultants, sysadmin, security engineers working with RHEL hardening and compliance automation.

# Tested Environment

This project was developed and tested on **Red Hat Enterprise Linux 8.10, 9.6**.
All oscap scans, remediation scripts, and compliance reports were validated against this release.

While the workflow should also apply to other RHEL major and minor releases, results may vary slightly depending on package versions and security content updates provided in the scap-security-guide.

(Optional) This project also leveraged Ansible for executing the remediation playbook generated by OSCAP, note that this is optional you can opt to use the bash script instead. The following versions were used during testing:

**RHEL 9.6**
- Ansible Core: 2.14.18

- community.general: 9.5.11

- ansible.posix: 1.5.4

**RHEL 8.10**
- Ansible Core: 2.16.3

- community.general: 11.3.0

- ansible.posix 2.1.0

Using these exact versions ensures compatibility with the provided playbooks and avoids potential issues caused by upstream changes in newer releases.

## CIS hardening with OSCAP 

### L1 Server
1. Head to https://access.redhat.com/downloads/content/479/ver=/rhel---8/8.3/x86_64/packages to download the `scap-security-guide` for your rhel version
   
2. ```bash
   dnf install -y openscap-scanner scap-security-guide
   ```
   
3. ```bash
   dnf localinstall <scap-security-guide>.rpm
   ```
   
4. Run a CIS Level 1 Server scan with OSCAP
   ```bash
   sudo oscap xccdf eval --profile xccdf_org.ssgproject.content_profile_cis_server_l1 --results /root/cis-l1-scan-results-before.xml --report /root/cis-l1-report-before.html /usr/share/xml/scap/ssg/content/ssg-rhel9-ds.xml
   ```
   
5. (Optional) Generate remediation ansible playbook
   ```bash
   sudo oscap xccdf generate fix --fix-type ansible --output CIS_L1_remediate.yml --result-id "" /root/cis-l1-scan-results-before.xml
   ```
    
6. Generate remediation bash script
   ```bash
   sudo oscap xccdf generate fix --fix-type bash --output CIS_L1_remediate.sh --result-id "" /root/cis-l1-scan-results-before.xml
   ```

7. Run remediation bash script or ansible playbook
   
8. Run a scan again to generate new report
   ```bash
   sudo oscap xccdf eval --profile xccdf_org.ssgproject.content_profile_cis_server_l1 --results /root/cis-l1-scan-results-after.xml --report /root/cis-l1-report-after.html /usr/share/xml/scap/ssg/content/ssg-rhel9-ds.xml
   ```

### L2 Server

1. Run a CIS Level 2 Server scan with OSCAP
   ```bash
   sudo oscap xccdf eval --profile xccdf_org.ssgproject.content_profile_cis --results /root/cis-l2-scan-results-before.xml --report /root/cis-l2-report-before.html /usr/share/xml/scap/ssg/content/ssg-rhel9-ds.xml
   ```
   
2. (Optional) Generate remediation ansible playbook
   ```bash
   sudo oscap xccdf generate fix --fix-type ansible --output CIS_L2_remediate.yml --result-id "" /root/cis-l2-scan-results-before.xml
   ```
   
3. Generate remediation bash script
   ```bash
   sudo oscap xccdf generate fix --fix-type bash --output CIS_L2_remediate.sh --result-id "" /root/cis-l2-scan-results-before.xml
   ```

4. Run remediation ansible playbook or remediation bash script

5. Run a scan again to generate new report
   ```bash
   sudo oscap xccdf eval --profile xccdf_org.ssgproject.content_profile_cis --results /root/cis-l2-scan-results-after.xml --report /root/cis-l2-report-after.html /usr/share/xml/scap/ssg/content/ssg-rhel9-ds.xml
   ```
   
Reference : https://www.redhat.com/en/blog/center-internet-security-cis-compliance-red-hat-enterprise-linux-using-openscap

### Additional useful OSCAP commands

Checking for available profiles
```bash
oscap info /usr/share/xml/scap/ssg/content/ssg-rhel9-ds.xml
```

